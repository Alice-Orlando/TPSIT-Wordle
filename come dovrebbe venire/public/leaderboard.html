<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Classifica â€” Wordle Italiano</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet" />
</head>
<body class="leaderboard-page">

  <div class="leaderboard-container">

    <!-- Header -->
    <header class="lb-header">
      <a href="index.html" class="back-link">â† Home</a>
      <div class="lb-title-wrap">
        <span class="lb-trophy">ğŸ†</span>
        <h1 class="lb-title">CLASSIFICA</h1>
      </div>
      <p class="lb-subtitle">I migliori giocatori â€” meno tentativi e meno tempo in cima</p>
    </header>

    <!-- Filtro difficoltÃ  -->
    <div class="lb-filters">
      <button class="filter-btn active" data-filter="all">TUTTI</button>
      <button class="filter-btn" data-filter="5">ğŸŒ± FACILE (5)</button>
      <button class="filter-btn" data-filter="6">ğŸ”¥ MEDIO (6)</button>
      <button class="filter-btn" data-filter="8">ğŸ’€ DIFFICILE (8)</button>
    </div>

    <!-- Statistiche globali -->
    <div class="lb-global-stats" id="globalStats">
      <div class="gs-box"><span id="gsTotal" class="gs-num">â€“</span><span class="gs-label">Partite totali</span></div>
      <div class="gs-box"><span id="gsWin"   class="gs-num">â€“</span><span class="gs-label">Vittorie</span></div>
      <div class="gs-box"><span id="gsRate"  class="gs-num">â€“</span><span class="gs-label">% Vittorie</span></div>
      <div class="gs-box"><span id="gsAvgT"  class="gs-num">â€“</span><span class="gs-label">Tempo medio</span></div>
    </div>

    <!-- Podio top 3 -->
    <div class="podium" id="podium">
      <!-- Generato da JS -->
    </div>

    <!-- Tabella classifica completa -->
    <div class="lb-table-wrapper">
      <table class="lb-table" id="lbTable">
        <thead>
          <tr>
            <th>#</th>
            <th>Giocatore</th>
            <th>Parola</th>
            <th>Tentativi</th>
            <th>Tempo</th>
            <th>DifficoltÃ </th>
            <th>Data</th>
          </tr>
        </thead>
        <tbody id="lbBody">
          <tr><td colspan="7" class="lb-loading">Caricamento...</td></tr>
        </tbody>
      </table>
    </div>

    <!-- Pulsante per tornare a giocare -->
    <div class="lb-cta">
      <a href="game.html" class="btn btn-play">â–¶ GIOCA ORA</a>
    </div>

  </div>

  <script>
    // â”€â”€ Stato â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let allResults    = [];
    let currentFilter = 'all';

    // â”€â”€ Formatter tempo (secondi â†’ mm:ss) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function formatTime(sec) {
      const m = Math.floor(sec / 60);
      const s = sec % 60;
      return `${m}:${s.toString().padStart(2, '0')}`;
    }

    // â”€â”€ Formatter data ISO â†’ leggibile â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function formatDate(iso) {
      const d = new Date(iso);
      return d.toLocaleDateString('it-IT', { day: '2-digit', month: '2-digit', year: '2-digit' });
    }

    function diffLabel(len) {
      return len === 5 ? 'ğŸŒ± Facile' : len === 6 ? 'ğŸ”¥ Medio' : 'ğŸ’€ Difficile';
    }

    // â”€â”€ Renderizza podio top 3 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderPodium(results) {
      const podium = document.getElementById('podium');
      podium.innerHTML = '';
      const top = results.slice(0, 3);
      const positions = [1, 0, 2]; // 2Â°, 1Â°, 3Â° per l'effetto podio
      const medals    = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'];
      const heights   = ['100px', '130px', '80px'];

      if (top.length === 0) {
        podium.innerHTML = '<p class="no-data">Nessuna vittoria ancora. Sii il primo!</p>';
        return;
      }

      positions.forEach(pos => {
        if (!top[pos]) return;
        const r   = top[pos];
        const div = document.createElement('div');
        div.className = `podium-block pos-${pos + 1}`;
        div.style.setProperty('--h', heights[pos]);
        div.innerHTML = `
          <div class="podium-info">
            <span class="podium-medal">${medals[pos]}</span>
            <span class="podium-name">${r.player}</span>
            <span class="podium-word">${r.word}</span>
            <span class="podium-detail">${r.attempts} tent. Â· ${formatTime(r.time)}</span>
          </div>
          <div class="podium-bar"></div>
          <div class="podium-rank">${pos + 1}</div>
        `;
        podium.appendChild(div);
      });
    }

    // â”€â”€ Renderizza tabella classifica â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderTable(results) {
      const tbody = document.getElementById('lbBody');
      if (results.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" class="no-data">Nessun risultato per questo filtro.</td></tr>';
        return;
      }
      tbody.innerHTML = results.map((r, i) => `
        <tr class="lb-row rank-${i < 3 ? i + 1 : 'other'}">
          <td class="lb-rank">${i + 1}</td>
          <td class="lb-player">${r.player}</td>
          <td class="lb-word">${r.word}</td>
          <td class="lb-attempts">${r.attempts}</td>
          <td class="lb-time">${formatTime(r.time)}</td>
          <td class="lb-diff">${diffLabel(r.difficulty)}</td>
          <td class="lb-date">${formatDate(r.date)}</td>
        </tr>
      `).join('');
    }

    // â”€â”€ Applica filtro â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function applyFilter(filter) {
      currentFilter = filter;
      let filtered = allResults;
      if (filter !== 'all') {
        filtered = allResults.filter(r => r.difficulty === parseInt(filter));
      }
      renderPodium(filtered);
      renderTable(filtered);

      // Evidenzia pulsante attivo
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.filter === filter);
      });
    }

    // â”€â”€ Carica statistiche globali â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    fetch('/api/stats')
      .then(r => r.json())
      .then(data => {
        document.getElementById('gsTotal').textContent = data.totalGames;
        document.getElementById('gsWin').textContent   = data.totalWins;
        document.getElementById('gsRate').textContent  = data.winRate + '%';
        document.getElementById('gsAvgT').textContent  = formatTime(data.avgTime);
      })
      .catch(() => {});

    // â”€â”€ Carica classifica dall'API Express â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // GET /api/leaderboard â€” chiamata all'endpoint che legge il JSON
    fetch('/api/leaderboard?limit=50')
      .then(r => r.json())
      .then(data => {
        allResults = data;
        applyFilter('all');
      })
      .catch(() => {
        document.getElementById('lbBody').innerHTML =
          '<tr><td colspan="7" class="no-data">Errore nel caricamento.</td></tr>';
      });

    // â”€â”€ Event listener filtri â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', () => applyFilter(btn.dataset.filter));
    });
  </script>

</body>
</html>
